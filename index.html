<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Billing System (Editable)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 40px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .logo {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input {
      padding: 10px;
      width: 100%;
    }

    button {
      padding: 10px 20px;
      margin-right: 10px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 12px;
      border: 1px solid #ccc;
      text-align: center;
    }

    tfoot td {
      font-weight: bold;
    }

    .actions {
      margin-top: 20px;
    }

    .report {
      display: none;
      margin-top: 30px;
    }

    .report h2 {
      text-align: center;
    }

    .action-btns button {
      margin: 0 4px;
    }

    @media print {
      body * {
        visibility: hidden;
      }

      .report, .report * {
        visibility: visible;
      }

      .report {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/a7/React-icon.svg" alt="Logo">
    </div>
    <h1>Billing System</h1>

    <div class="form-row">
      <input type="text" id="itemName" placeholder="Item Name">
      <input type="number" id="itemQty" placeholder="Quantity" min="1">
      <input type="number" id="itemPrice" placeholder="Price" min="0" step="0.01">
      <button id="addOrUpdateBtn" onclick="addOrUpdateItem()">Add</button>
    </div>

    <table id="billTable">
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- Items go here -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3">Grand Total</td>
          <td id="grandTotal">$0.00</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="actions">
      <button onclick="confirmBill()">‚úÖ Confirm</button>
      <button onclick="resetBill()">üîÑ Reset</button>
    </div>

    <div class="report" id="report">
      <h2>üßæ Billing Report</h2>
      <div id="reportContent"></div>
    </div>
  </div>

  <script>
    let items = [];
    let grandTotal = 0;
    let editIndex = -1;

    // Load from localStorage
    window.onload = function () {
      const stored = localStorage.getItem("billingData");
      if (stored) {
        const parsed = JSON.parse(stored);
        items = parsed.items;
        grandTotal = parsed.total || 0;
        renderTable();
      }
    };

    function addOrUpdateItem() {
      const name = document.getElementById('itemName').value.trim();
      const qty = parseFloat(document.getElementById('itemQty').value);
      const price = parseFloat(document.getElementById('itemPrice').value);

      if (!name || isNaN(qty) || isNaN(price) || qty <= 0 || price < 0) {
        alert("Please enter valid item details.");
        return;
      }

      const total = qty * price;

      if (editIndex >= 0) {
        // Editing existing item
        grandTotal -= items[editIndex].total;
        items[editIndex] = { name, qty, price, total };
        grandTotal += total;
        editIndex = -1;
        document.getElementById('addOrUpdateBtn').textContent = 'Add';
      } else {
        // Adding new item
        items.push({ name, qty, price, total });
        grandTotal += total;
      }

      saveToStorage();
      renderTable();

      document.getElementById('itemName').value = '';
      document.getElementById('itemQty').value = '';
      document.getElementById('itemPrice').value = '';
    }

    function renderTable() {
      const tbody = document.querySelector('#billTable tbody');
      tbody.innerHTML = '';

      items.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td>$${item.price.toFixed(2)}</td>
          <td>$${item.total.toFixed(2)}</td>
          <td class="action-btns">
            <button onclick="editItem(${index})">‚úèÔ∏è Edit</button>
            <button onclick="deleteItem(${index})">üóëÔ∏è Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    }

    function saveToStorage() {
      localStorage.setItem("billingData", JSON.stringify({
        items,
        total: grandTotal
      }));
    }

    function editItem(index) {
      const item = items[index];
      document.getElementById('itemName').value = item.name;
      document.getElementById('itemQty').value = item.qty;
      document.getElementById('itemPrice').value = item.price;
      document.getElementById('addOrUpdateBtn').textContent = 'Update Item';
      editIndex = index;
    }

    function deleteItem(index) {
      if (confirm("Are you sure you want to delete this item?")) {
        grandTotal -= items[index].total;
        items.splice(index, 1);
        saveToStorage();
        renderTable();
      }
    }

    function confirmBill() {
      if (items.length === 0) {
        alert("No items to confirm.");
        return;
      }

      const report = document.getElementById('report');
      const content = document.getElementById('reportContent');
      report.style.display = 'block';

      let html = `
        <table border="1" style="width:100%; border-collapse: collapse; margin-top: 10px;">
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
      `;

      items.forEach(item => {
        html += `
          <tr>
            <td>${item.name}</td>
            <td>${item.qty}</td>
            <td>$${item.price.toFixed(2)}</td>
            <td>$${item.total.toFixed(2)}</td>
          </tr>
        `;
      });

      html += `
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3"><strong>Grand Total</strong></td>
              <td><strong>$${grandTotal.toFixed(2)}</strong></td>
            </tr>
          </tfoot>
        </table>
      `;

      content.innerHTML = html;

      saveToStorage(); // Ensure latest is saved
      window.print();
    }

    function resetBill() {
      if (!confirm("Are you sure you want to reset the bill?")) return;

      localStorage.removeItem("billingData");
      items = [];
      grandTotal = 0;
      editIndex = -1;
      renderTable();
      document.getElementById('reportContent').innerHTML = '';
      document.getElementById('report').style.display = 'none';
    }
  </script>
</body>
</html>
